import{u as e}from"./vue-router-2e9de4c5.js";import{e as t,i as s,f as o,j as l,Z as n,o as a,c as i,a as f,n as r,ai as u,V as c,T as h,K as m,P as d,ay as w,az as y,O as x,R as p}from"./@vue-bf6c6ff6.js";import{_ as v}from"./index-83cd5377.js";import{d as g}from"./dayjs-20d6c7c9.js";import"./@element-plus-7f5482a3.js";import"./element-plus-4d915d47.js";import"./lodash-es-d4f5f48c.js";import"./@vueuse-dc4a31b0.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./vxe-table-a26a84aa.js";import"./xe-utils-79f6bbe6.js";import"./aplayer-5d7f43e3.js";import"./dom-zindex-e3f8f991.js";import"./axios-86de682d.js";import"./vuex-7f823aa9.js";import"./vue-i18n-9a9600a9.js";import"./@intlify-b74bcea3.js";let b=t([]),k=!1;function Y(e,t,s,o=!0){let l=e.getContext("2d");l.strokeStyle="blue",l.lineWidth=2,k=o;let n=0,a=0;e.onmousemove=function(o){let i;if(n=o.offsetX,a=o.offsetY,0===t.length)X(e,l,t);else if(void 0===s)t.forEach((function(s,o){s.w>0&&s.h>0&&n>s.x&&n<s.x+s.w&&a>s.y&&a<s.y+s.h&&(i=o,R(e,l,t,i)),s.w<0&&s.h>0&&n<s.x&&n>s.x+s.w&&a>s.y&&a<s.y+s.h&&(i=o,R(e,l,t,i)),s.w>0&&s.h<0&&n>s.x&&n<s.x+s.w&&a<s.y&&a>s.y+s.h&&(i=o,R(e,l,t,i)),s.w<0&&s.h<0&&n<s.x&&n>s.x+s.w&&a<s.y&&a>s.y+s.h&&(i=o,R(e,l,t,i)),void 0===i&&X(e,l,t)}));else for(let f=0;f<t.length;f++){let o=t[f];if(n<o.x+5&&n>o.x-5&&a<o.y+5&&a>o.y-5){if(f===s){j(e,l,t,s,1);break}}else if(n<o.x+o.w+5&&n>o.x+o.w-5&&a<o.y+5&&a>o.y-5){if(f===s){j(e,l,t,s,2);break}}else if(n<o.x+5&&n>o.x-5&&a<o.y+o.h+5&&a>o.y+o.h-5){if(f===s){j(e,l,t,s,3);break}}else if(n<o.x+o.w+5&&n>o.x+o.w-5&&a<o.y+o.h+5&&a>o.y+o.h-5){if(f===s){j(e,l,t,s,4);break}}else{if(o.w>0&&o.h>0&&n>o.x&&n<o.x+o.w&&a>o.y&&a<o.y+o.h){i=f,R(e,l,t,f);break}if(o.w<0&&o.h>0&&n<o.x&&n>o.x+o.w&&a>o.y&&a<o.y+o.h){i=f,R(e,l,t,f);break}if(o.w>0&&o.h<0&&n>o.x&&n<o.x+o.w&&a<o.y&&a>o.y+o.h){i=f,R(e,l,t,f);break}if(o.w<0&&o.h<0&&n<o.x&&n>o.x+o.w&&a<o.y&&a>o.y+o.h){i=f,R(e,l,t,f);break}void 0===i&&X(e,l,t)}}e.onmouseout=function(){void 0!==s&&Y(e,t,s,k)}},b.value=[],b.value=t}function j(e,t,s,o,l){e.style.cursor="pointer";let n=s[o];e.onmousedown=function(a){let i=a.offsetX,f=a.offsetY,r=n.w,u=n.h,c=n.x,h=n.y;e.onmousemove=function(n){let a={};switch(l){case 1:if(a={x:n.offsetX,y:n.offsetY,w:r+(i-n.offsetX),h:u+(f-n.offsetY)},k){let t=r+i-n.offsetX,s=u+f-n.offsetY,o=_(e,n.offsetX,n.offsetY,t,s);a={x:o.x,y:o.y,w:o.w,h:o.h}}break;case 2:if(a={x:c,y:n.offsetY,w:r-i+n.offsetX,h:u+f-n.offsetY},k){let t=r-i+n.offsetX,s=u+f-n.offsetY,o=_(e,c,n.offsetY,t,s);a={x:o.x,y:o.y,w:o.w,h:o.h}}break;case 3:if(a={x:n.offsetX,y:n.offsetY-(u-f+n.offsetY),w:r+i-n.offsetX,h:u-f+n.offsetY},k){let t=r+i-n.offsetX,s=u-f+n.offsetY,o=_(e,n.offsetX,n.offsetY-s,t,s);a={x:o.x,y:o.y,w:o.w,h:o.h}}break;case 4:if(a={x:c,y:h,w:r-i+n.offsetX,h:u-f+n.offsetY},k){let t=r-i+n.offsetX,s=u-f+n.offsetY,o=_(e,c,h,t,s);a={x:o.x,y:o.y,w:o.w,h:o.h}}}for(let e in a)s[o][e]=a[e];P(e,t,s,o)},e.onmouseout=function(){P(e,t,s),Y(e,s,null,k)},E(e,t,s,o)}}function X(e,t,s){e.style.cursor="crosshair";let o=!1,l=0,n=0;e.onmousedown=function(a){o=!0,l=a.offsetX,n=a.offsetY,E(e,t,s,null),e.onmousemove=function(a){o&&(P(e,t,s),t.beginPath(),t.setLineDash([8,4]),t.rect(l,n,a.offsetX-l,a.offsetY-n),t.stroke())},e.onmouseup=function(a){if(o&&Math.abs(a.offsetX-l)>10&&Math.abs(a.offsetY-n)>10){let i={x:l,y:n,w:a.offsetX-l,h:a.offsetY-n};if(k){let t=_(e,l,n,a.offsetX-l,a.offsetY-n);i={x:t.x,y:t.y,w:t.w,h:t.h}}s.push(i),P(e,t,s),o=!1,Y(e,s,null,k)}else P(e,t,s),o=!1,Y(e,s,null,k)},e.onmouseout=function(a){if(o&&Math.abs(a.offsetX-l)>10&&Math.abs(a.offsetY-n)>10){let i={x:l,y:n,w:a.offsetX-l,h:a.offsetY-n};if(k){let t=_(e,l,n,a.offsetX-l,a.offsetY-n);i={x:t.x,y:t.y,w:t.w,h:t.h}}s.push(i),P(e,t,s),o=!1,Y(e,s,null,k)}else P(e,t,s),o=!1,Y(e,s,null,k)}}}function R(e,t,s,o){e.style.cursor="default";let l=0,n=0;e.onmousedown=function(a){l=a.offsetX,n=a.offsetY,P(e,t,s,o),e.onmouseup=function(){P(e,t,s,o),Y(e,s,o,k)},function(e,t,s,o,l,n){let a=s[o],i=a.x,f=a.y;e.onmousemove=function(r){let u={x:i+r.offsetX-l,y:f+r.offsetY-n,w:a.w,h:a.h};if(k){let t=i+r.offsetX-l,s=f+r.offsetY-n,o=_(e,t,s,a.w,a.h);u={x:o.x,y:o.y,w:o.w,h:o.h}}for(let e in u)s[o][e]=u[e];E(e,t,s,o),P(e,t,s,o)},e.onmouseup=function(){P(e,t,s,o),Y(e,s,o,k)}}(e,t,s,o,l,n),E(e,t,s,o)}}function E(e,t,s,o){e.onkeydown=null===o?function(){return!1}:function(l){8==(l.keyCode||l.which)&&null!==o&&(s.length>=1?(s.splice(o,1),P(e,t,s)):t.clearRect(0,0,e.width,e.height),E(e,t,s,null),P(e,t,s),Y(e,s,null,k))}}function P(e,t,s,o){t.setLineDash([8,0]),t.clearRect(0,0,e.width,e.height),s.forEach((function(e,s){void 0!==o&&s==o||(t.beginPath(),t.strokeStyle="blue",t.rect(e.x,e.y,e.w,e.h),t.stroke())})),s.forEach((function(e,s){s===o&&(t.beginPath(),t.strokeStyle="red",t.rect(e.x,e.y,e.w,e.h),t.fillStyle="RGBA(102,102,102,0.2)",t.fillRect(e.x,e.y,e.w,e.h),t.stroke(),t.beginPath(),t.strokeStyle="red",t.arc(e.x,e.y,4,0,2*Math.PI),t.fillStyle="white",t.fill(),t.stroke(),t.beginPath(),t.arc(e.x,e.y+e.h,4,0,2*Math.PI),t.fillStyle="white",t.fill(),t.stroke(),t.beginPath(),t.arc(e.x+e.w,e.y+e.h,4,0,2*Math.PI),t.fillStyle="white",t.fill(),t.stroke(),t.beginPath(),t.arc(e.x+e.w,e.y,4,0,2*Math.PI),t.fillStyle="white",t.fill(),t.stroke())}))}function _(e,t,s,o,l){let n=e.width,a=e.height;return t<0?t=0:t+o>n&&(t=n-o-4>0?n-o-4:0),s<0?s=0:s+l>a&&(s=a-l-4>0?a-l-4:0),{x:t,y:s,w:o,h:l}}const z={class:"content",ref:"contentRef"},L={ref:"markCanvasRef",tabindex:"0"},S=v({__name:"DrawRectangle",setup(e){const{proxy:u}=s(),c=t([]);o((()=>b.value),(e=>{}),{deep:!0});const h=()=>{r((()=>{let e=u.$refs.markCanvasRef,t=u.$refs.contentRef;const s=null==t?void 0:t.offsetWidth,o=null==t?void 0:t.offsetHeight;e.width=s||"800",e.height=o||"600";let l=e.getContext("2d");l.strokeStyle="blue",e.style.cursor="crosshair";let n=c.value;n.forEach((function(t,s,o){let l={x:t.x*e.width,y:t.y*e.height,w:t.w*e.width,h:t.h*e.height};n.splice(s,1,l)})),0!==n.length&&n.forEach((function(e,t,s){l.rect(e.x,e.y,e.w,e.h),l.stroke()})),Y(e,n)}))};return l((()=>{h(),window.addEventListener("resize",(()=>{setTimeout((()=>{h()}),200)}))})),n((()=>{window.removeEventListener("resize",(()=>{}))})),(e,t)=>(a(),i("div",z,[f("canvas",L,null,512)],512))}},[["__scopeId","data-v-58bdc258"]]),C={class:""},V={__name:"MathsCompute",setup:e=>(e,t)=>(a(),i("div",C," 数学计算题组件 "))},M=e=>(w("data-v-405a2826"),e=e(),y(),e),U={class:"signature h100 w100 pr flex-col-s"},D={class:"btn-box w100 flex-c"},$={class:"flex-s margin-r10"},O=M((()=>f("span",{class:"demonstration"},"画笔颜色：",-1))),I={class:"flex-s margin-r10"},T=M((()=>f("span",{class:"demonstration"},"画笔大小：",-1))),W={class:"flex-s wh-size margin-r10"},A=M((()=>f("span",{class:"demonstration"},"画布大小：",-1))),H={ref:"canvasRef"},B={class:"w100 flex-c margin-tb10"},F=["src"],G={components:{DrawRectangle:S,MathsCompute:V,Signature:v({__name:"Signature",setup(e){const{proxy:o}=s();let r=null,w=null,y=[];const x=t("#1E1E1E"),p=t("2"),v=t(400),b=t(200),k=t(),Y=t(),j=()=>{r=o.$refs.canvasRef;let e=o.$refs.containerRef;k.value=null==e?void 0:e.offsetWidth,Y.value=null==e?void 0:e.offsetHeight,r.width=k.value||"800",r.height=Y.value||"600",r.style.cursor="crosshair",w=r.getContext("2d");let t=!1,s={};r.addEventListener("mousedown",(e=>{t=!0})),r.addEventListener("mousemove",(e=>{t&&(s={x:e.offsetX,y:e.offsetY},y.push(s),l(y))})),window.addEventListener("mouseup",(()=>{t=!1,s={},y=[],w.closePath()}));const l=e=>{w.beginPath(),e.forEach(((e,t)=>{0===t?w.moveTo(e.x,e.y):w.lineTo(e.x,e.y)})),w.strokeStyle=x.value||"green",w.lineWidth=p.value||3,w.stroke()}},X=()=>{w.clearRect(0,0,k.value,Y.value)},R=t(""),E=g(),P=async e=>{let t=E.format("YYYY-MM-DD HH:mm:ss"),s=_(r.toDataURL("image/png"));if(1===e)R.value=URL.createObjectURL(s);else if(2===e){if(window.showSaveFilePicker){const e=await window.showSaveFilePicker({suggestedName:`signature-${t}.png`,types:[{description:"PNG file",accept:{"image/png":[".png"]}}]}),o=await e.createWritable();return await o.write(s),await o.close(),e}{const e=document.createElement("a");e.download=`signature-${t}.png`,e.href=URL.createObjectURL(s),e.click(),URL.revokeObjectURL(e.href)}}},_=e=>{let t=e.split(","),s="",o="";t.length>1&&(o=t[1],s=t[0].substring(t[0].indexOf(":")+1,t[0].indexOf(";")));let l=atob(o),n=new ArrayBuffer(l.length),a=new Uint8Array(n);for(let i=0;i<l.length;i++)a[i]=l.charCodeAt(i);return new Blob([n],{type:s})},z=()=>{j()};return l((()=>{j(),window.addEventListener("resize",(()=>{setTimeout((()=>{j()}),200)}))})),n((()=>{window.removeEventListener("resize",(()=>{}))})),(e,t)=>{const s=u("el-color-picker"),o=u("el-input-number"),l=u("el-button");return a(),i("div",U,[f("div",D,[f("div",$,[O,c(s,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=e=>x.value=e),size:"small"},null,8,["modelValue"])]),f("div",I,[T,c(o,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e),min:1,max:10,size:"small","controls-position":"right"},null,8,["modelValue"])]),f("div",W,[A,c(o,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=e=>v.value=e),min:1,max:999,size:"small","controls-position":"right",style:{"margin-right":"5px"},onChange:z},null,8,["modelValue"]),h("- "),c(o,{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=e=>b.value=e),min:1,max:999,size:"small","controls-position":"right",style:{"margin-left":"5px"},onChange:z},null,8,["modelValue"])])]),f("div",{class:"main-area w100 f1 margin-t20",style:m({"--border":x.value})},[f("div",{class:"canvas-box",style:m({"--w":`${v.value}px`,"--h":`${b.value}px`}),ref:"containerRef"},[f("canvas",H,null,512)],4),f("div",B,[c(l,{type:"primary",size:"small",onClick:X},{default:d((()=>[h("重绘")])),_:1}),c(l,{type:"primary",size:"small",onClick:t[4]||(t[4]=e=>P(1))},{default:d((()=>[h("预览")])),_:1}),c(l,{type:"primary",size:"small",onClick:t[5]||(t[5]=e=>P(2))},{default:d((()=>[h("生成")])),_:1})]),f("img",{class:"img",src:R.value,alt:"",srcset:""},null,8,F)],4)])}}},[["__scopeId","data-v-405a2826"]])}},N=Object.assign(G,{__name:"details",setup(o){s();const n=e(),i=t("");return l((()=>{var e;i.value=(null==(e=n.params)?void 0:e.type)||"DrawRectangle"})),(e,t)=>{const s=u("g-detail");return a(),x(s,null,{default:d((()=>[(a(),x(p(i.value)))])),_:1})}}});export{N as default};
